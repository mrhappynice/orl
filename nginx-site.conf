server {
  listen 80;
  server_name _;

  # PWA
  root /srv/web;
  index index.html;

  location / {
    try_files $uri $uri/ /index.html;
  }

  include /etc/nginx/mime.types;
  types {
    application/manifest+json webmanifest;
    application/vnd.apple.mpegurl m3u8;
    video/mp2t ts;
  }

  # HLS - Files are now local at /hls
  location /hls/ {
    alias /hls/;
    add_header Cache-Control "no-cache";
    add_header Access-Control-Allow-Origin "*";
    access_log /var/log/nginx/hls_access.log;
  }

  # Dashboard
  location /dashboard/ {
    alias /srv/dashboard/;
    try_files $uri $uri/ =404;
  }

  # Stats API - Proxy to the Python process running on localhost:8080
  location /api/ {
    proxy_pass http://127.0.0.1:8080/api/;
    proxy_set_header Host $host;
    proxy_buffering off;
  }

  add_header X-Content-Type-Options nosniff;
  add_header X-Frame-Options DENY;
  add_header Referrer-Policy no-referrer;
}